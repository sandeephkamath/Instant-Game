<html>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
<script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script
	src='https://www.jqueryscript.net/demo/Easy-jQuery-Progress-Bar-Timer-Plugin-For-Bootstrap-3-progressTimer/js/jquery.progressTimer.js'></script>

<script src="https://hammerjs.github.io/dist/hammer.js"></script>
<style>
	.btn-circle.btn-xl {
		width: 300px;
		height: 300px;
		padding: 10px 10px;
		font-size: 150px;
		line-height: 1.33;
		border-radius: 150px;
	}

	#progressTimer {
		width: 100%;
		height: 10%;
		position: fixed;
		bottom: 0%;
	}

	#block-container {
		position: fixed;
		top: 50%;
		left: 50%;
		-webkit-transform: translate(-50%, -50%);
		transform: translate(-50%, -50%);
	}
</style>


<script type="text/javascript">


	$(document).ready(function () {
		$("#progressTimer").progressTimer({
			timeLimit: 60,
			warningThreshold: 50,
			baseStyle: 'progress-bar-info',
			warningStyle: 'progress-bar-danger',
			completeStyle: 'progress-bar-danger',
			onFinish: function () {
				this.gameOver = true

			}
		});
		setState()

		initSwipeDetection()

	});


	var state
	var direction
	var score = 0
	var gameOver = false

	document.onkeydown = checkKey;

	function checkKey(e) {

		if (gameOver) {
			return
		}

		e = e || window.event;

		if (e.keyCode == '38') {
			validate(2)
		}
		else if (e.keyCode == '40') {
			// down arrow
			validate(3)
		}
		else if (e.keyCode == '37') {
			// left arrow
			validate(0)
		}
		else if (e.keyCode == '39') {
			// right arrow
			validate(1)
		}

	}



	function validate(inputDirection) {
		if (state == 0) {
			if (direction == inputDirection) {
				scoreAdd()
			} else {
				wrong()
			}
		} else {
			if (inputDirection == 0 && direction == 1) {
				scoreAdd()
			} else if (inputDirection == 1 && direction == 0) {
				scoreAdd()
			} else if (inputDirection == 2 && direction == 3) {
				scoreAdd()
			} else if (inputDirection == 3 && direction == 2) {
				scoreAdd()
			} else {
				wrong()
			}
		}

		console.log("Score = " + score)
	}

	function wrong() {
		$("#block-container").effect("shake", { times: 2 });
	}

	function scoreAdd() {
		score += 1
		setState()
	}

	function setState() {
		state = getRandom(0, 2)
		direction = getRandom(0, 4)
		setUI()
	}

	function getRandom(max, min) {
		return Math.floor(Math.random() * (max - min)) + min;
	}

	function setUI() {
		setArrow()
		setColor();
		$("#block-container").hide();
		$("#block-container").fadeIn();
	}

	function setArrow() {
		var dirImg
		switch (direction) {
			case 0:
				dirImg = "left"
				break
			case 1:
				dirImg = "right"
				break
			case 2:
				dirImg = "up"
				break
			case 3:
				dirImg = "down"
				break
		}
		var className = "glyphicon glyphicon-arrow-" + dirImg
		console.log(className)
		$("#arrow").removeClass()
		$("#arrow").addClass(className);
	}

	function setColor() {
		var color
		switch (state) {
			case 0:
				color = "info"
				break
			case 1:
				color = "danger"
				break
		}
		var classNames = "btn btn-" + color + " btn-circle btn-xl"
		console.log(classNames)
		$("#block").removeClass()
		$("#block").addClass(classNames);
	}

	function initSwipeDetection() {
		var myElement = document.getElementById('block');
		var mc = new Hammer(myElement);
		//enable all directions
		mc.get('swipe').set({
			direction: Hammer.DIRECTION_ALL,
			threshold: 1,
			velocity: 0.1
		});
		// listen to events...
		mc.on("swipeup swipedown swipeleft swiperight tap press", function (ev) {
			console.log(ev.type)
			switch (ev.type) {
				case 'swipeleft':
					validate(0)
					break
				case 'swiperight':
					validate(1)
					break
				case 'swipeup':
					validate(2)
					break
				case 'swipedown':
					validate(3)
					break
			}
		});
	}




</script>



<body>

	<div id="block-container">
		<button id="block" type="button" class="btn btn-info btn-circle btn-xl"><i id="arrow"
				class="glyphicon glyphicon-arrow-right"></i></button>
	</div>

	<div id="progressTimer"></div>

</body>

</html>